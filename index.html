<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>AudioPlay-url</title>
</head>
<body>
    <p>
        <input type="text" id="audioUrl" placeholder="音声ファイルのURL">
        <button onclick="playAudio();">再生</button>
        <button onclick="pauseAudio();">停止</button>
        <button onclick="playPreviousTrack();">前の曲</button>
        <button onclick="playNextTrack();">次の曲</button>
        <button onclick="loopAudio();">ループ</button>
        <button onclick="removeCurrentTrack();">削除</button>
        <button onclick="fadeAudio();">15minスリープ</button>

<script>
    function fadeAudio() {
        setTimeout(function() {
            let fadeAudio = setInterval(function () {
                if (audio.volume > 0.1) {
                    audio.volume -= 0.1;
                } else {
                    clearInterval(fadeAudio);
                    audio.pause();
                }
            }, 1500);
        }, 900000);  // 15分後にフェードアウトを開始
    }
</script>
<!-- 音量スライダー -->
        <input type="range" id="volumeSlider" min="0" max="1" step="0.01" onchange="adjustVolume();" value="0.5">
<!-- TEXTアウトプット -->
    </p>
    <p id="audioTitle"></p>
    <p id="loopStatus"></p>
    <ul id="titleHistory"></ul>

    <script>
        const audio = new Audio();
        const audioUrlInput = document.getElementById("audioUrl");
        const audioTitleDisplay = document.getElementById("audioTitle");
        const loopStatusDisplay = document.getElementById("loopStatus");
        const titleHistoryList = document.getElementById("titleHistory");
        const volumeSlider = document.getElementById("volumeSlider");
        const playlist = [];
        let currentTrackIndex = 0;

        audio.addEventListener('ended', function () {
            if (currentTrackIndex < playlist.length - 1) {
                playNextTrack();
            } else {
                currentTrackIndex = 0;
                audio.src = playlist[currentTrackIndex];
                audio.play();
                const nextTitle = getTitleFromUrl(playlist[currentTrackIndex]);
                audioTitleDisplay.textContent = `Now playing: ${nextTitle}`;
            }
        });

    function playAudio() {
        const modifiedUrl = audioUrlInput.value.replace("https://www.dropbox.com/scl/fi/", "https://dl.dropboxusercontent.com/scl/fi/");
        audio.src = modifiedUrl;
        audio.volume = 0.5;  // 再生時の音量を0.5に設定
        volumeSlider.value = 0.5;  // スライダーの値も0.5に更新
        audio.play();
        const title = getTitleFromUrl(modifiedUrl);
        audioTitleDisplay.textContent = `Now playing: ${title}`;
        playlist.push(modifiedUrl);
        currentTrackIndex = playlist.length - 1;
        const titleHistoryItem = document.createElement("li");
        titleHistoryItem.textContent = title;
        titleHistoryList.appendChild(titleHistoryItem);
    }

        function pauseAudio() {
            audio.pause();
        }

        function loopAudio() {
            audio.loop = !audio.loop;
            loopStatusDisplay.textContent = audio.loop ? "ループ再生中" : "";
        }
//GETtitle
        function getTitleFromUrl(url) {
            const cleanUrl = url.split("?rlkey=")[0];
            const parts = cleanUrl.split("/");
            return parts[parts.length - 1];
        }

        function playNextTrack() {
            if (currentTrackIndex < playlist.length - 1) {
                currentTrackIndex++;
                audio.src = playlist[currentTrackIndex];
                audio.play();
                const nextTitle = getTitleFromUrl(playlist[currentTrackIndex]);
                audioTitleDisplay.textContent = `Now playing: ${nextTitle}`;
            }
        }

        function playPreviousTrack() {
            if (currentTrackIndex > 0) {
                currentTrackIndex--;
                audio.src = playlist[currentTrackIndex];
                audio.play();
                const prevTitle = getTitleFromUrl(playlist[currentTrackIndex]);
                audioTitleDisplay.textContent = `Now playing: ${prevTitle}`;
            }
        }

        function removeCurrentTrack() {
            if (playlist.length > 0) {
                playlist.splice(currentTrackIndex, 1);
                if (currentTrackIndex >= playlist.length) {
                    currentTrackIndex = playlist.length - 1;
                }
                if (playlist.length > 0) {
                    audio.src = playlist[currentTrackIndex];
                    audio.play();
                    const currentTitle = getTitleFromUrl(playlist[currentTrackIndex]);
                    audioTitleDisplay.textContent = `Now playing: ${currentTitle}`;
                } else {
                    audio.src = "";
                    audioTitleDisplay.textContent = "";
                }
                updateTitleHistory();
            }
        }

        function updateTitleHistory() {
            titleHistoryList.innerHTML = "";
            for (const url of playlist) {
                const title = getTitleFromUrl(url);
                const titleHistoryItem = document.createElement("li");
                titleHistoryItem.textContent = title;
                titleHistoryList.appendChild(titleHistoryItem);
            }
        }

        function adjustVolume() {
            audio.volume = volumeSlider.value;
        }
    </script>
    <details>
　<summary>説明</summary>
        <br>主にDropboxの共有用URLに対応しています。
        <br>URLを入力してファイルの音声を再生できます。
        <br>ループボタンでシングルループできます。
        <br>最後の曲が再生し終わると最初の曲に戻ります。
        <br>URLを再生するごとにプレイリストに曲が追加されます。
        <br>音量調節はスライドバーでできます。<br> 
</details>
    
  <details>
　<summary>EXURL</summary>
      <br>
      <h>URLをコピペして試してみよう！</h>
 <li>「MEGALOVANIA」https://www.dropbox.com/scl/fi/z2go7xfot0yq0cvilyj71/UNDERTALE-MEGALOVANIA.mp3?rlkey=u1nwkmas8iyi6ujgrgkimigyc&dl=0</li>
　　<li>「コペルカクテル」https://www.dropbox.com/scl/fi/ue9gv2dw29051u6adxzv7/コペルカクテル.mp3?rlkey=753njs0ojb95zmnhb0b8i6vkv&dl=0</li>
　　<li>「まちゃプリン」https://www.dropbox.com/scl/fi/8isf6upmzg0v54b1i7qe8/まちゃプリン.wav?rlkey=1jesgdenhxgh33v18z4c2r3ir&dl=0</li>
　　<li>「スノーハース」https://www.dropbox.com/scl/fi/cpd7gmbcghn8nl33iou9a/スノーハース.mp3?rlkey=wjqqiz672ipv9jfo8eekdtl5u&dl=0</li>
      <br> 
</details>
  
</body>
</html>
